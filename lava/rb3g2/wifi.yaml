actions:
- deploy:
    images:
      image:
        headers:
          Authentication: Q_GITHUB_TOKEN
        url: "https://quic-yocto-fileserver-1029608027416.us-central1.run.app/qualcomm-linux/meta-qcom/15574355116-1/qcs6490-rb3gen2-core-kit/core-image-base-qcs6490-rb3gen2-core-kit.rootfs.qcomflash.tar.gz"
    postprocess:
      docker:
        image: ghcr.io/foundriesio/lava-lmp-sign:main
        steps:
        - export IMAGE_PATH=$PWD
        - cp overlay*.tar.gz overlay.tar.gz
        - echo "OVERLAY=overlay.tar.gz" >> $IMAGE_PATH/flash.settings
        - echo "OVERLAY_PATH=/home/" >> $IMAGE_PATH/flash.settings
        - echo "DEVICE_TYPE=qcs6490-rb3gen2" >> $IMAGE_PATH/flash.settings
        - cat $IMAGE_PATH/flash.settings
    timeout:
      minutes: 5
    to: downloads
- deploy:
    images:
      image:
        url: downloads://core-image-base-qcs6490-rb3gen2-core-kit.rootfs.qcomflash.tar.gz
      settings:
        url: downloads://flash.settings
      overlay:
        url: downloads://overlay.tar.gz
    timeout:
      minutes: 5
    to: flasher
- boot:
    auto_login:
      login_prompt: 'login:'
      username: root
    method: minimal
    prompts:
    - root@qcs6490-rb3gen2-core-kit
    timeout:
      minutes: 3
- command:
    name: network_turn_on

- test:
    definitions:
    - from: git
      name: wlan-smoke
      parameters:
        DEVICE: 'wlx00037f12aeae'
      path: automated/linux/wlan-smoke/wlan-smoke.yaml
      repository: http://github.com/linaro/test-definitions.git
    - from: git
      name: wlan-download
      parameters:
        DEVICE: 'wlx00037f12aeae'
        ETHERNET_DEVICE: ''
        FILE_CHECKSUM: 8388f7232b400bdc80279668847f90da
        FILE_URL: http://archive.ubuntu.com/ubuntu/dists/bionic/main/installer-amd64/current/images/netboot/mini.iso
        SSID_NAME: "{{ AP_NAME }}"
        SSID_PASSWORD: "{{ AP_PASSWORD }}"
        TIME_DELAY: 120s
      path: automated/linux/wlan-download/wlan-download.yaml
      repository: http://github.com/linaro/test-definitions.git
    timeout:
      minutes: 30 
context:
  lava_test_results_dir: /home/lava-%s
  test_character_delay: 10
device_type: qcs6490-rb3gen2-core-kit
job_name: wifi test (qcs6490-rb3gen2-core-kit) 12591501185
metadata:
  downloads-url: "{{ DOWNLOADS_URL }}"
priority: 50
tags:
- cambridge-lab
- wlan-test
timeouts:
  job:
    minutes: 15
visibility: personal


